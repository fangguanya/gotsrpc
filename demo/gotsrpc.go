// this file was auto generated by gotsrpc https://github.com/foomo/gotsrpc
package demo

import (
	gotsrpc "github.com/foomo/gotsrpc"
	http "net/http"
)

type ServiceGoTSRPCProxy struct {
	EndPoint    string
	allowOrigin []string
	service     *Service
}

func NewServiceGoTSRPCProxy(service *Service, endpoint string, allowOrigin []string) *ServiceGoTSRPCProxy {
	return &ServiceGoTSRPCProxy{
		EndPoint:    endpoint,
		allowOrigin: allowOrigin,
		service:     service,
	}
}

// ServeHTTP exposes your service
func (p *ServiceGoTSRPCProxy) ServeHTTP(w http.ResponseWriter, r *http.Request) {

	for _, origin := range p.allowOrigin {
		w.Header().Add("Access-Control-Allow-Origin", origin)
	}
	w.Header().Set("Access-Control-Allow-Credentials", "true")
	if r.Method != "POST" {
		gotsrpc.ErrorMethodNotAllowed(w)
		return
	}

	var args []interface{}
	switch gotsrpc.GetCalledFunc(r, p.EndPoint) {
	case "Hello":
		args = []interface{}{""}
		err := gotsrpc.LoadArgs(args, r)
		if err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		helloReply, helloErr := p.service.Hello(args[0].(string))
		gotsrpc.Reply([]interface{}{helloReply, helloErr}, w)
		return
	case "ExtractAddress":
		args = []interface{}{&Person{}}
		err := gotsrpc.LoadArgs(args, r)
		if err != nil {
			gotsrpc.ErrorCouldNotLoadArgs(w)
			return
		}
		extractAddressAddr, extractAddressE := p.service.ExtractAddress(args[0].(*Person))
		gotsrpc.Reply([]interface{}{extractAddressAddr, extractAddressE}, w)
		return
	case "TestScalarInPlace":
		testScalarInPlaceRet := p.service.TestScalarInPlace()
		gotsrpc.Reply([]interface{}{testScalarInPlaceRet}, w)
		return
	case "Nest":
		nestRet := p.service.Nest()
		gotsrpc.Reply([]interface{}{nestRet}, w)
		return
	default:
		http.Error(w, "404 - not found "+r.URL.Path, http.StatusNotFound)
	}
}
